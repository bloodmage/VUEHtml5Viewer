<html lang="en">
        <head>
                <title>ShootingDemo</title>
                <meta charset="utf-8">
                <style media="screen">
                #holder {

                    left: 50%;
                    position: absolute;
                    top: 50%;
                    height: 400px;
                    margin: -200px 0 0 -200px;
                    width: 400px;
                    background: black;
                }
                </style>
        </head>
        <body>
                <script src="knockout-2.1.0.js"></script>
                <script src="jquery-1.7.2.min.js"></script>
                <script src="komodel.js"></script>
                <script src="raphael.js"></script>
                <script src="shooting.js"></script>
                <script src="player.js"></script>
                <script>
                        Raphael(function() {
                            var r=Raphael("holder");
                            player.setself(r.circle(200,380,2).attr({'stroke-width':3,stroke:'#00FF00',fill:'#ffffff'}));
                            //Frame
                            var dead = false;
                            window.setInterval(function(){
                                    if (dead) return;
                                    var cir=r.circle(Math.random()*400,Math.random()*400,5);
//                                    cir.attr({'stroke-width':0});
                                    var dx=Math.random()-0.5, dy=Math.random()-0.5;
                                    var rmd=Math.sqrt(dx*dx+dy*dy)/(Math.random()*1.5+1);
                                    cir.deltax=dx/rmd;
                                    cir.deltay=dy/rmd;
                                    cir.destroy=cir.remove;
                                    cir.entity=false;
                                    cir.ticks=0;
                                    cir.mr=Math.random()*64+190;
                                    cir.mg=Math.random()*64+190;
                                    cir.mb=Math.random()*64+190;
                                    cir.attr({fill:Raphael.rgb(cir.mr,cir.mg,cir.mb),
                                              'fill-opacity':0});
                                    cir.tick=function(){
                                            if(cir.ticks<30) {
                                                    cir.ticks++;
                                                    cir.attr({'fill-opacity':cir.ticks*cir.ticks*cir.ticks/27000.0});
                                            } else { cir.entity=true; cir.attr({stroke:Raphael.rgb(200,0,0),'stroke-width':2});}
                                    };
                                    bullets.addbullet(cir);
                            },20);

                            window.setInterval(function(){
                                    if (dead) return;
                                    bullets.nextmove();
                                    player.tick();
                                    if (bullets.detectcoll(player.x,player.y)) {
                                            dead = true;
                                            bullets.clear();
                                            player.dead();
                                            alert('DEAD');
                                    };
                            },10);
                        });
                        
                </script>
                <div>Bullets: <span data-bind="text: bulletcount">0</span>, FPS: <span data-bind="text: fpscount">0</span> </div>
                
                <div id="holder"></div>
        </body>
</html>
