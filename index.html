<html>
	<head>
		<script src="jquery-1.7.1.min.js" type="text/javascript"></script>
		<script src="raphael-min.js" type="text/javascript"></script>
		<script src="scaleraphael.js" type="text/javascript"></script>
		<script src="jmw.js" type="text/javascript"></script>
		<script src="vuelitemodel.js"></script>
		<script src="vuerender.js"></script>
	</head>
    <body oncontextmenu="return false;">
    	<center id="prepare">
			<img src="loading.gif"><br/>
			<font face="verdana"><h1><font color="red">V</font><font color="orange">U</font><font color="purple">E</font> <font color="darkgreen">Reader</font> preparing</h1></font>
		</center>
		<script language="JavaScript">
			var model;
			//Mouse interactivity
			function MouseStart(sw,sh) {
				var moving = false;
				var stx, sty;
				var scaling = 1.0;
				var l=0.0,t=0.0;
				paper.changeSize(sw/scaling,sh/scaling);
				$('#holdvp')
					.mousedown(function(eobj){
						if (eobj.which!=3) return;
						stx = eobj.clientX;
						sty = eobj.clientY;
						moving=true;
						eobj.stopPropagation();
						eobj.preventDefault();
					})
					.mousemove(function(eobj){
						if (!moving) return;
						var tl = l + (eobj.clientX-stx),
							tt = t + (eobj.clientY-sty);
						$('#holder').css('left',tl).css('top',tt);
						
						eobj.stopPropagation();
						eobj.preventDefault();
					})
					.mouseup(function(eobj){
						if (!moving) return;
						if (eobj.which!=3) return;
						l = l + (eobj.clientX-stx);
						t = t + (eobj.clientY-sty);
						$('#holder').css('left',l).css('top',t);
						moving = false;
						eobj.stopPropagation();
						eobj.preventDefault();
						return false;
					})
					.mousewheel(function(eobj, delta, deltaX, deltaY) {
						//Keep stady point unchanged
						var sx = (l - eobj.clientX)*scaling;
						var sy = (t - eobj.clientY)*scaling;

						if (delta<0) scaling = scaling * 1.1; else scaling = scaling / 1.1;
						
						paper.changeSize(sw/scaling,sh/scaling);
						
						l = sx/scaling + eobj.clientX;
						t = sy/scaling + eobj.clientY;
						$('#holder').css('left',l).css('top',t);
						 
						var xmid = 0;
					});
			}
			$(setTimeout(function(){
				$('#logpane').prepend('Program loaded.<br/>');
				$.ajax({
					type: 'GET',
					url: 'data.vue',
					dataType: 'text',
					success: function(data) {
						/*Fix VUE to follow standard*/
						var xml = $.parseXML('<?xml version="1.0" encoding="US-ASCII"?>'+data.replace('<?xml version="1.0" encoding="US-ASCII"?>',''));
						
						model = new VUELiteModel(xml);
						paper = VUERender(model, "holder"); //Change this on demand
						
						$('#prepare').hide();
						$('#logpane').hide();
						
						MouseStart(model.width, model.height);
					}
				});
			},1000));
		</script>
		<div id="logpane" style="position:absolute; left:0; top:0; background-color:darkgreen; color:white;"></div>
		<div id="holdvp" style="position:absolute;left:0;top:0;width:100%;height:100%;overflow:hidden;">
		<div id="holder" style="position:absolute;left:0;top:0;"></div>
		</div>	
    </body>
</html>

